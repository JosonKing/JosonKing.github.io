<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>高级指引 | Joson</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="半个前端">
    
    <link rel="preload" href="/assets/css/0.styles.f9ce61dc.css" as="style"><link rel="preload" href="/assets/js/app.74973d11.js" as="script"><link rel="preload" href="/assets/js/2.e3d6ea38.js" as="script"><link rel="preload" href="/assets/js/19.30f7b22a.js" as="script"><link rel="prefetch" href="/assets/js/10.a0d90a3c.js"><link rel="prefetch" href="/assets/js/11.7b32d79c.js"><link rel="prefetch" href="/assets/js/12.09d13fd4.js"><link rel="prefetch" href="/assets/js/13.149223d9.js"><link rel="prefetch" href="/assets/js/14.7a2e71ac.js"><link rel="prefetch" href="/assets/js/15.92dd56a6.js"><link rel="prefetch" href="/assets/js/16.2daabb4c.js"><link rel="prefetch" href="/assets/js/17.7a18aa01.js"><link rel="prefetch" href="/assets/js/18.f8d30851.js"><link rel="prefetch" href="/assets/js/20.264517ba.js"><link rel="prefetch" href="/assets/js/21.8ce214fc.js"><link rel="prefetch" href="/assets/js/22.6da7ce69.js"><link rel="prefetch" href="/assets/js/23.6b86d589.js"><link rel="prefetch" href="/assets/js/24.fd9803e4.js"><link rel="prefetch" href="/assets/js/25.48fa05e7.js"><link rel="prefetch" href="/assets/js/3.06bb0782.js"><link rel="prefetch" href="/assets/js/4.40ace952.js"><link rel="prefetch" href="/assets/js/5.ecce7737.js"><link rel="prefetch" href="/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/assets/js/7.a84db8e6.js"><link rel="prefetch" href="/assets/js/8.98ee17e2.js"><link rel="prefetch" href="/assets/js/9.267e1bbe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f9ce61dc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="Joson" class="logo"> <span class="site-name can-hide">Joson</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link router-link-active">
  笔记
</a></div><div class="nav-item"><a href="/front-end/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/blog/" class="nav-link">
  博客
</a></div> <a href="https://github.com/JosonKing/josonking.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link router-link-active">
  笔记
</a></div><div class="nav-item"><a href="/front-end/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/blog/" class="nav-link">
  博客
</a></div> <a href="https://github.com/JosonKing/josonking.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/css/grid.html" class="sidebar-link">CSS Grid 网格布局教程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>npm</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/npm/started.html" class="sidebar-link">npm 基础命令</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>module</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/module/module.html" class="sidebar-link">JS模块化规范</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/react/installation.html" class="sidebar-link">安装</a></li><li><a href="/note/react/main-concepts.html" class="sidebar-link">核心概念</a></li><li><a href="/note/react/advanced-guides.html" aria-current="page" class="active sidebar-link">高级指引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/react/advanced-guides.html#代码分割" class="sidebar-link">代码分割</a></li><li class="sidebar-sub-header"><a href="/note/react/advanced-guides.html#context" class="sidebar-link">Context</a></li><li class="sidebar-sub-header"><a href="/note/react/advanced-guides.html#错误边界" class="sidebar-link">错误边界</a></li><li class="sidebar-sub-header"><a href="/note/react/advanced-guides.html#refs-转发" class="sidebar-link">Refs 转发</a></li><li class="sidebar-sub-header"><a href="/note/react/advanced-guides.html#高阶组件" class="sidebar-link">高阶组件</a></li><li class="sidebar-sub-header"><a href="/note/react/advanced-guides.html#与第三方库协同" class="sidebar-link">与第三方库协同</a></li><li class="sidebar-sub-header"><a href="/note/react/advanced-guides.html#深入-jsx" class="sidebar-link">深入 JSX</a></li></ul></li><li><a href="/note/react/hook.html" class="sidebar-link">HOOK</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>react-router</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/react-router/guide.html" class="sidebar-link">安装</a></li><li><a href="/note/react-router/started.html" class="sidebar-link">简介</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>redux</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/redux/started.html" class="sidebar-link">基本用法</a></li><li><a href="/note/redux/action.html" class="sidebar-link">中间件与异步操作</a></li><li><a href="/note/redux/react-redux.html" class="sidebar-link">React-Redux 的用法</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="高级指引"><a href="#高级指引" class="header-anchor">#</a> 高级指引</h1> <h2 id="代码分割"><a href="#代码分割" class="header-anchor">#</a> 代码分割</h2> <h3 id="打包"><a href="#打包" class="header-anchor">#</a> 打包</h3> <p>大多数 React 应用都会使用 Webpack，Rollup 或 Browserify 这类的构建工具来打包文件。 打包是一个将文件引入并合并到一个单独文件的过程，最终形成一个 “bundle”。 接着在页面上引入该 bundle，整个应用即可一次性加载。</p> <p>示例
App文件：</p> <div class="language- extra-class"><pre class="language-text"><code>// app.js
import { add } from './math.js';
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>console.log(add(16, 26)); // 42
// math.js
export function add(a, b) {
  return a + b;
}
</code></pre></div><p>打包后文件：</p> <div class="language- extra-class"><pre class="language-text"><code>function add(a, b) {
  return a + b;
}

console.log(add(16, 26)); // 42
</code></pre></div><h3 id="代码分割-2"><a href="#代码分割-2" class="header-anchor">#</a> 代码分割</h3> <p>打包是个非常棒的技术，但随着你的应用增长，你的代码包也将随之增长。尤其是在整合了体积巨大的第三方库的情况下。你需要关注你代码包中所包含的代码，以避免因体积过大而导致加载时间过长。</p> <p>为了避免搞出大体积的代码包，在前期就思考该问题并对代码包进行分割是个不错的选择。 代码分割是由诸如 Webpack，Rollup 和 Browserify（factor-bundle）这类打包器支持的一项技术，能够创建多个包并在运行时动态加载。</p> <p>对你的应用进行代码分割能够帮助你“懒加载”当前用户所需要的内容，能够显著地提高你的应用性能。尽管并没有减少应用整体的代码体积，但你可以避免加载用户永远不需要的代码，并在初始加载的时候减少所需加载的代码量。</p> <h4 id="import"><a href="#import" class="header-anchor">#</a> import()</h4> <p>在你的应用中引入代码分割的最佳方式是通过动态 import() 语法。</p> <p>使用之前：</p> <div class="language- extra-class"><pre class="language-text"><code>import { add } from './math';

console.log(add(16, 26));
</code></pre></div><p>使用之后：</p> <div class="language- extra-class"><pre class="language-text"><code>import(&quot;./math&quot;).then(math =&gt; {
  console.log(math.add(16, 26));
});
</code></pre></div><p>当 Webpack 解析到该语法时，会自动进行代码分割。如果你使用 Create React App，该功能已开箱即用，你可以立刻使用该特性。Next.js 也已支持该特性而无需进行配置。</p> <p>如果你自己配置 Webpack，你可能要阅读下 Webpack 关于代码分割的指南。你的 Webpack 配置应该类似于此。</p> <p>当使用 Babel 时，你要确保 Babel 能够解析动态 import 语法而不是将其进行转换。对于这一要求你需要 babel-plugin-syntax-dynamic-import 插件。</p> <h2 id="context"><a href="#context" class="header-anchor">#</a> Context</h2> <blockquote><p>Context 提供了一个无需为每层组件手动添加 props，就能在组件树间进行数据传递的方法。</p></blockquote> <p>在一个典型的 React 应用中，数据是通过 props 属性自上而下（由父及子）进行传递的，但这种做法对于某些类型的属性而言是极其繁琐的（例如：地区偏好，UI 主题），这些属性是应用程序中许多组件都需要的。Context 提供了一种在组件之间共享此类值的方式，而不必显式地通过组件树的逐层传递 props。</p> <h3 id="何时使用-context"><a href="#何时使用-context" class="header-anchor">#</a> 何时使用 Context</h3> <p>Context 设计目的是为了共享那些对于一个组件树而言是“全局”的数据，例如当前认证的用户、主题或首选语言。</p> <h3 id="使用-context-之前的考虑"><a href="#使用-context-之前的考虑" class="header-anchor">#</a> 使用 Context 之前的考虑</h3> <p>在组件树中很多不同层级的组件需要访问同样的一批数据。Context 能让你将这些数据向组件树下所有的组件进行“广播”，所有的组件都能访问到这些数据，也能访问到后续的数据更新。使用 context 的通用的场景包括管理当前的 locale，theme，或者一些缓存数据，这比替代方案要简单的多。</p> <h3 id="api"><a href="#api" class="header-anchor">#</a> API</h3> <h2 id="错误边界"><a href="#错误边界" class="header-anchor">#</a> 错误边界</h2> <h3 id="错误边界-error-boundaries"><a href="#错误边界-error-boundaries" class="header-anchor">#</a> 错误边界（Error Boundaries）</h3> <p>部分 UI 的 JavaScript 错误不应该导致整个应用崩溃，为了解决这个问题，React 16 引入了一个新的概念 —— 错误边界。</p> <p>错误边界是一种 React 组件，这种组件可以捕获并打印发生在其子组件树任何位置的 JavaScript 错误，并且，它会渲染出备用 UI，而不是渲染那些崩溃了的子组件树。错误边界在渲染期间、生命周期方法和整个组件树的构造函数中捕获错误。</p> <blockquote><p>错误边界无法捕获以下场景中产生的错误：</p> <ul><li>事件处理（了解更多）</li> <li>异步代码（例如 setTimeout 或 requestAnimationFrame 回调函数）</li> <li>服务端渲染</li> <li>它自身抛出来的错误（并非它的子组件）</li></ul></blockquote> <p>如果一个 class 组件中定义了 static getDerivedStateFromError() 或 componentDidCatch() 这两个生命周期方法中的任意一个（或两个）时，那么它就变成一个错误边界。当抛出错误后，请使用 static getDerivedStateFromError() 渲染备用 UI ，使用 componentDidCatch() 打印错误信息。</p> <p>错误边界的工作方式类似于 JavaScript 的 catch {}，不同的地方在于错误边界只针对 React 组件。只有 class 组件才可以成为错误边界组件。大多数情况下, 你只需要声明一次错误边界组件, 并在整个应用中使用它。</p> <p>注意错误边界仅可以捕获其子组件的错误，它无法捕获其自身的错误。如果一个错误边界无法渲染错误信息，则错误会冒泡至最近的上层错误边界，这也类似于 JavaScript 中 catch {} 的工作机制。</p> <h3 id="未捕获错误-uncaught-errors-的新行为"><a href="#未捕获错误-uncaught-errors-的新行为" class="header-anchor">#</a> 未捕获错误（Uncaught Errors）的新行为</h3> <p>自 React 16 起，任何未被错误边界捕获的错误将会导致整个 React 组件树被卸载。</p> <h2 id="refs-转发"><a href="#refs-转发" class="header-anchor">#</a> Refs 转发</h2> <blockquote><p>Ref 转发是一项将 ref 自动地通过组件传递到其一子组件的技巧。对于可重用的组件库是很有用的。</p></blockquote> <h3 id="转发-refs-到-dom-组件"><a href="#转发-refs-到-dom-组件" class="header-anchor">#</a> 转发 refs 到 DOM 组件</h3> <p>FancyButton 或 MyTextInput 这样的高可复用“叶”组件倾向于在整个应用中以一种类似常规 DOM button 和 input 的方式被使用，并且访问其 DOM 节点对管理焦点，选中或动画来说是不可避免的。</p> <p>Ref 转发是一个可选特性，其允许某些组件接收 ref，并将其向下传递（换句话说，“转发”它）给子组件。</p> <h2 id="高阶组件"><a href="#高阶组件" class="header-anchor">#</a> 高阶组件</h2> <blockquote><p>高阶组件（HOC）是 React 中用于复用组件逻辑的一种高级技巧。HOC 自身不是 React API 的一部分，它是一种基于 React 的组合特性而形成的设计模式。</p></blockquote> <blockquote><p>高阶组件是参数为组件，返回值为新组件的函数。</p></blockquote> <h3 id="使用-hoc-解决横切关注点问题"><a href="#使用-hoc-解决横切关注点问题" class="header-anchor">#</a> 使用 HOC 解决横切关注点问题</h3> <p>在一个大型应用程序中，我们需要一个抽象，允许我们在一个地方定义相同逻辑，并在许多组件之间共享它。这正是高阶组件擅长的地方。</p> <p>编写一个创建组件函数。该函数将接受一个子组件作为它的其中一个参数，该子组件将订阅数据作为 prop。</p> <p>HOC 不会修改传入的组件，也不会使用继承来复制其行为。相反，HOC 通过将组件包装在容器组件中来组成新组件。HOC 是纯函数，没有副作用。</p> <p>被包装组件接收来自容器组件的所有 prop，同时也接收一个新的用于 render 的 data prop。HOC 不需要关心数据的使用方式或原因，而被包装组件也不需要关心数据是怎么来的。</p> <h3 id="不要改变原始组件-使用组合"><a href="#不要改变原始组件-使用组合" class="header-anchor">#</a> 不要改变原始组件,使用组合</h3> <h2 id="与第三方库协同"><a href="#与第三方库协同" class="header-anchor">#</a> 与第三方库协同</h2> <h3 id="集成带有-dom-操作的插件"><a href="#集成带有-dom-操作的插件" class="header-anchor">#</a> 集成带有 DOM 操作的插件</h3> <p>我们会添加一个 ref 到这个根 DOM 元素。 在 componentDidMount 中，我们能够获取它的引用这样我们就可以把它传递给 jQuery 插件了。</p> <p>为了防止 React 在挂载之后去触碰这个 DOM，我们会从 render() 函数返回一个空的 <code>&lt;div /&gt;</code>。这个 <code>&lt;div /&gt;</code> 元素既没有属性也没有子元素，所以 React 没有理由去更新它，使得 jQuery 插件可以自由的管理这部分的 DOM：</p> <h2 id="深入-jsx"><a href="#深入-jsx" class="header-anchor">#</a> 深入 JSX</h2> <p>JSX 仅仅只是 React.createElement(component, props, ...children) 函数的语法糖。如下 JSX 代码：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;MyButton color=&quot;blue&quot; shadowSize={2}&gt;
  Click Me
&lt;/MyButton&gt;
</code></pre></div><p>会编译为：</p> <div class="language- extra-class"><pre class="language-text"><code>React.createElement(
  MyButton,
  {color: 'blue', shadowSize: 2},
  'Click Me'
)
</code></pre></div><h3 id="在运行时选择类型"><a href="#在运行时选择类型" class="header-anchor">#</a> 在运行时选择类型</h3> <div class="language- extra-class"><pre class="language-text"><code>import React from 'react';
import { PhotoStory, VideoStory } from './stories';

const components = {
  photo: PhotoStory,
  video: VideoStory
};

function Story(props) {
  // 正确！JSX 类型可以是大写字母开头的变量。
  const SpecificStory = components[props.storyType];
  return &lt;SpecificStory story={props.story} /&gt;;
}
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/vuejs/vuepress/edit/master/docs/note/react/advanced-guides.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/25/2020, 6:19:17 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/react/main-concepts.html" class="prev">
        核心概念
      </a></span> <span class="next"><a href="/note/react/hook.html">
        HOOK
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.74973d11.js" defer></script><script src="/assets/js/2.e3d6ea38.js" defer></script><script src="/assets/js/19.30f7b22a.js" defer></script>
  </body>
</html>
